---
layout: post
title:  "Boosting the bicycle athlete"
math: true
date:   2022-06-12 13:53:16 +0200
tags: strava.com crawler datamining scraping gradient-boosting-models gradient-descent SHAPE-value decision-tree random-forest catboost xgboost lightgbm
---
My recently finished master thesis dealt with the subject of gradient boosting models applied to a dataset scraped from [www.strava.com](strava.com). A scraper written in *C#* was used to collect over 60.000 observations of training exercises from professional bicycle athletes. A diagram of the scraper is added below.

![Diagram of the strava scraper](https://github.com/Npaffen/ds-blog/blob/main/docs/assets/strava_scraper.png?raw=true)
*  $$\textit{Note.}$$Diagram of the working process of the Strava scraper. All user interactions are marked by full line arrows, all automized interactions by the strava scraper are highlighted by coloured dotted arrows. Colours were added just for visual purpose. "*" - signs at the end of a description indicate that this process interacts with strava.com. Therefore a sleep timer after each url call is used to prevent a timeout.*

The strava dataset contains training sessions from 185 professional road cyclists from the UCI World Teams list which featured 19 teams in 2020. The strava dataset contains 61840 observations. The Strava dataset contains training sessions from 185 professional road cyclists from the UCI World Teams list which featured 19 teams in 2020. The Strava dataset contains 61840 observations. Table 1 presents an overview of all variables of the Strava dataset. 18 variables were obtained or generated from training activities of the Strava website between 2018-01-01 and 2021-0318. The variables age, height, climber_points, sprinter_points were obtained by data from procyclingstats.com. The two latter variables are the points an athlete achieved for their race results in climbing or sprinting competitions respectively. These variables were then used to create a new variable type. Each observation of the Strava dataset was matched with the aggregated point score from the first day of the year to the activity day of the year for each athlete gained from climbing and sprinting races respectively. Let $$d_{l}$$ be defined as the date of an observation $$i$$ of the Strava dataset of athlete $k, \mathrm{D}$ is the date of the observation for which the categorization type was determined and $$D \geq d$$ is valid. Then, we can define the type of each athlete $$k$$ at each training activity $$i_{D}$$ by the following rule:

$$
\begin{gather}
\scriptsize
type_{i_D, k} =
\begin{cases}
climber  & \mbox{if} \quad \sum_{i_{d}}^{i_{D}}climber\_points_{i_d, k} >  \biggl\{ \sum_{i_{d}}^{i_{D}}sprinter\_points_{i_d, k} \biggr\}*1.25 \\
& \mbox{and} \quad  \biggl\{\sum_{i_{d}}^{i_{D}}climber\_points_{i_d, k} -  \sum_{i_{d}}^{i_{D}}sprinter\_points_{i_d, k} \biggr\} \geq 30  \\
sprinter & \mbox{if} \quad  \sum_{i_{d}}^{i_{D}}sprinter\_points_{i_d, k} >  \biggl\{ \sum_{i_{d}}^{i_{D}}climber\_points_{i_d, k} \biggr\}*1.25   \\
 & \mbox{and} \quad  \biggl\{\sum_{i_{d}}^{i_{D}}sprinter\_points_{i_d, k} -  \sum_{i_{d}}^{i_{D}}climber\_points_{i_d, k} \biggr\} \geq 30 \\
mixed   &  \mbox{else}
\end{cases}
\label{eq:type_rule}
\end{gather}
$$

$$
\begin{table}[H]
	\scriptsize
	\renewcommand{\theadfont}{\small}
	\caption{Variable list of the Strava dataset}
	\begin{tabularx}{\linewidth}{@{}>{\hangindent=1em}X>{\itshape}l@{}}
		\toprule
		\thead[l]{\textbf{Variable name} Description}&
		\upshape\thead[l]{Variable\\ type} \\
		\midrule
		\textbf{$date :$}
		The date of an training observation.
		& factor \\
		\addlinespace
		\textbf{$avg\_power^* :$}
		Average power in watt generated during the ride.
		& numeric \\
		\addlinespace
		\textbf{$avg\_power\_weig :$}
		Adjusted avg. power of the ride where a Strava algorithm corrects possible outliers in the data due to environmental impacts such as terrain, grade, wind and possible other factors not disclosed on the Strava website.
		& numeric \\
		\addlinespace
		\textbf{$estAvgPower :$}
		Another estimate of the avg power of an activity generated by Strava. No further information about calculation were found.
		& numeric \\
		\addlinespace
		\textbf{$distance^* :$}
		Distance of the training session in km.
		& numeric \\
		\addlinespace
		\textbf{$elevation^* :$}
		Amount of meters of the route which contains elevation.
		& numeric \\
		\addlinespace
		\textbf{$avg\_power\_comb^* :$}
		Generated variable by combining \textit{avg\_power}, \textit{avg\_power\_weig} and \textit{estAvgPower}.
		& numeric \\
		\addlinespace
		\textbf{$work\_total^* :$}
		The sum of watts generated during the ride, expressed in kilojoules(kJ).
		& numeric \\
		\addlinespace
		\textbf{$training\_load^* :$}
		Indicator for how long an athlete should rest after an activity. Power of a ride is compared to an individual functional threshold power. The latter is defined as the highest power output a road cyclist can preserve in a semisteady state for approximately 60 minutes.
		& numeric \\
		\addlinespace
		\textbf{$intensity^* :$}
		An indicator to express the level of difficulty of a ride compared to the functional threshold power.
		& numeric \\
		\addlinespace
		\textbf{$avg\_speed^* :$}
		Average speed of the ride.
		& numeric \\
		\addlinespace
		\textbf{$max\_speed^* :$}
		Max speed of the ride.
		& numeric \\
		\addlinespace
		\textbf{$avg\_cadence^* :$}
		Average pedaling rate, average number of revolutions of the crank during the activity.
		& numeric \\
		\addlinespace
		\textbf{$max\_cadence^* :$}
		Max pedalling rate, maximal number of revolutions of the crank during the activity.
		& numeric \\
		\addlinespace
		\textbf{$avg\_hearRate^* :$}
		Average heart rate during the ride.
		& numeric \\
		\addlinespace
		\textbf{$max\_heartRate^* :$}
		Max heart rate during the ride.
		& numeric \\
		\addlinespace
		\textbf{$max\_power^* :$}
		Max power in watt generated during the ride.
		& numeric  \\
		\addlinespace
		\textbf{$avg\_calories^* :$}
		Average calories burned during the ride.
		& numeric \\
		\addlinespace
		\textbf{$avg\_temperature^* :$}
		Average temperature during the ride.
		& numeric\\
		\addlinespace
		\textbf{$avg\_elap\_time\_sec^* :$}
		Average  elapsed time in seconds during the ride.
		& numeric \\
		\addlinespace
		\textbf{$age^* :$}
		The age of the athlete.
		& numeric \\
		\addlinespace
		\textbf{$type^* :$}
		Categorical variable indicating if an cyclists is either of type 'climber','sprinter' or 'mixed'
		& factor \\
		\addlinespace
		\textbf{$height^* :$}
		The height of the athlete.
		& numeric \\
		\addlinespace
		\textbf{$season^* :$}
		Season of the year of the activity : spring, summer, autumn, winter.
		& factor \\
		\addlinespace
		\textbf{$UCI\_points\_weekly^* :$}
		Indicates the weekly UCI points an athlete had on the in that week  of the training activity.
		& numeric \\
	 \bottomrule
	\end{tabularx}
	\label{tab:var_list}
\end{table}
$$
